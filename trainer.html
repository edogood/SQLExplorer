<!doctype html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trainer | SQL Lab</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;600;700;800&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="bg-shape bg-shape-one" aria-hidden="true"></div>
  <div class="bg-shape bg-shape-two" aria-hidden="true"></div>

  <header class="site-header">
    <div class="header-inner">
      <a href="index.html" class="brand">SQL Lab Completo</a>
      <nav class="top-nav">
        <a href="playground.html">Playground</a>
        <a href="database.html">Database</a>
        <a href="exercises.html">Esercizi</a>
        <a href="guided.html">Percorso</a>
        <a href="trainer.html">Trainer</a>
        <a href="syntax.html">Sintassi</a>
        <a href="keywords.html">Keyword</a>
      </nav>
    </div>
  </header>

  <main class="page">
    <section class="hero">
      <p class="kicker">Keyword Trainer</p>
      <h1>Allenamento keyword per dialetto</h1>
      <p class="hero-copy">Scegli una keyword e aprila nel Playground con starter query e verifica automatica.</p>
    </section>

    <section class="panel">
      <div class="panel-head">
        <h2>Keyword disponibili</h2>
        <p>Seleziona una categoria o cerca per nome. Clicca per aprire nel Playground.</p>
      </div>
      <div class="keyword-toolbar">
        <input id="trainerPageSearch" type="text" placeholder="Cerca keyword...">
        <select id="trainerPageCategory">
          <option value="Tutte">Tutte</option>
          <option value="Query">Query</option>
          <option value="DML">DML</option>
          <option value="DDL">DDL</option>
          <option value="Transazioni">Transazioni</option>
          <option value="Avanzato/SQLite">Avanzato/SQLite</option>
        </select>
      </div>
      <div id="trainerPageList" class="exercise-grid"></div>
    </section>
  </main>

  <script>
  (function () {
    var TRAINER_KEYWORDS = [
      { keyword: "SELECT", category: "Query", query: "SELECT id, name, segment, credit_limit\nFROM customers\nWHERE segment = 'Enterprise'\nORDER BY credit_limit DESC\nLIMIT 20;" },
      { keyword: "JOIN", category: "Query", query: "SELECT o.id, c.name, o.total_amount\nFROM orders o\nJOIN customers c ON c.id = o.customer_id\nWHERE o.status = 'PAID'\nLIMIT 20;" },
      { keyword: "LEFT JOIN", category: "Query", query: "SELECT c.name, COUNT(o.id) AS n_orders\nFROM customers c\nLEFT JOIN orders o ON o.customer_id = c.id\nGROUP BY c.id\nLIMIT 20;" },
      { keyword: "GROUP BY", category: "Query", query: "SELECT c.segment, ROUND(SUM(o.total_amount), 2) AS revenue\nFROM customers c\nJOIN orders o ON o.customer_id = c.id\nGROUP BY c.segment\nORDER BY revenue DESC;" },
      { keyword: "HAVING", category: "Query", query: "SELECT c.segment, ROUND(SUM(o.total_amount), 2) AS revenue\nFROM customers c\nJOIN orders o ON o.customer_id = c.id\nGROUP BY c.segment\nHAVING SUM(o.total_amount) > 250000\nORDER BY revenue DESC;" },
      { keyword: "WITH (CTE)", category: "Query", query: "WITH monthly AS (\n  SELECT substr(order_date, 1, 7) AS mese,\n         ROUND(SUM(total_amount), 2) AS totale\n  FROM orders\n  GROUP BY substr(order_date, 1, 7)\n)\nSELECT * FROM monthly ORDER BY mese;" },
      { keyword: "CASE", category: "Query", query: "SELECT id, total_amount,\n       CASE\n         WHEN total_amount >= 2000 THEN 'high'\n         WHEN total_amount >= 800 THEN 'mid'\n         ELSE 'low'\n       END AS amount_bucket\nFROM orders\nLIMIT 20;" },
      { keyword: "CAST", category: "Query", query: "SELECT id, CAST(total_amount AS INTEGER) AS total_int\nFROM orders\nLIMIT 20;" },
      { keyword: "COALESCE", category: "Query", query: "SELECT id, COALESCE(discount_amount, 0) AS discount_safe\nFROM orders\nLIMIT 20;" },
      { keyword: "NULLIF", category: "Query", query: "SELECT id, total_amount / NULLIF(discount_amount, 0) AS ratio\nFROM orders\nLIMIT 20;" },
      { keyword: "ROW_NUMBER", category: "Query", query: "SELECT customer_id, total_amount,\n       ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY total_amount DESC) AS rn\nFROM orders\nLIMIT 40;" },
      { keyword: "LAG", category: "Query", query: "SELECT order_date, total_amount,\n       LAG(total_amount) OVER (ORDER BY order_date) AS prev_total\nFROM orders\nLIMIT 40;" },
      { keyword: "LEAD", category: "Query", query: "SELECT order_date, total_amount,\n       LEAD(total_amount) OVER (ORDER BY order_date) AS next_total\nFROM orders\nLIMIT 40;" },
      { keyword: "INSERT", category: "DML", query: "BEGIN;\nINSERT INTO customer_notes (customer_id, note_date, note_type, note_text, author_employee_id)\nVALUES (1, '2026-02-10', 'followup', 'Trainer insert test', 2);\nSELECT customer_id, note_type FROM customer_notes ORDER BY id DESC LIMIT 1;\nROLLBACK;" },
      { keyword: "UPDATE", category: "DML", query: "BEGIN;\nUPDATE products SET price = ROUND(price * 1.01, 2) WHERE category = 'Software';\nSELECT category, ROUND(AVG(price), 2) AS avg_price FROM products GROUP BY category;\nROLLBACK;" },
      { keyword: "DELETE", category: "DML", query: "BEGIN;\nDELETE FROM customer_notes WHERE note_type = 'obsolete';\nSELECT changes() AS deleted_rows;\nROLLBACK;" },
      { keyword: "BEGIN", category: "Transazioni", query: "BEGIN;\nUPDATE products SET price = ROUND(price * 0.95, 2) WHERE category = 'Hardware';\nSELECT name, price FROM products WHERE category = 'Hardware' LIMIT 5;\nROLLBACK;" },
      { keyword: "ROLLBACK", category: "Transazioni", query: "BEGIN;\nDELETE FROM customer_notes WHERE note_type = 'obsolete';\nSELECT COUNT(*) FROM customer_notes;\nROLLBACK;" },
      { keyword: "CREATE TABLE", category: "DDL", query: "CREATE TEMP TABLE trainer_tmp (id INTEGER PRIMARY KEY, label TEXT);\nSELECT * FROM trainer_tmp;" },
      { keyword: "ALTER TABLE", category: "DDL", query: "CREATE TEMP TABLE trainer_alter (id INTEGER PRIMARY KEY);\nALTER TABLE trainer_alter ADD COLUMN note TEXT;\nPRAGMA table_info(trainer_alter);" },
      { keyword: "CREATE INDEX", category: "DDL", query: "CREATE TEMP TABLE trainer_idx (id INTEGER PRIMARY KEY, code TEXT);\nCREATE INDEX idx_trainer_code ON trainer_idx(code);\nPRAGMA index_list(trainer_idx);" },
      { keyword: "EXPLAIN", category: "Avanzato/SQLite", query: "EXPLAIN QUERY PLAN\nSELECT c.name, SUM(o.total_amount)\nFROM customers c\nJOIN orders o ON o.customer_id = c.id\nGROUP BY c.id;" }
    ];

    var searchInput = document.getElementById("trainerPageSearch");
    var categorySelect = document.getElementById("trainerPageCategory");
    var listContainer = document.getElementById("trainerPageList");
    if (!listContainer) return;

    function render() {
      var term = (searchInput ? searchInput.value : "").trim().toLowerCase();
      var cat = categorySelect ? categorySelect.value : "Tutte";
      var filtered = TRAINER_KEYWORDS.filter(function (kw) {
        if (cat !== "Tutte" && kw.category !== cat) return false;
        if (term && kw.keyword.toLowerCase().indexOf(term) === -1) return false;
        return true;
      });

      if (!filtered.length) {
        listContainer.innerHTML = '<p class="info-block">Nessuna keyword trovata con i filtri correnti.</p>';
        return;
      }

      listContainer.innerHTML = filtered.map(function (kw) {
        var encodedQuery = encodeURIComponent(kw.query);
        var link = "playground.html?q=" + encodedQuery + "&autorun=1#trainer";
        return '<article class="keyword-card"><div class="keyword-head"><h3>' + kw.keyword + '</h3><span class="tag">' + kw.category + '</span></div>' +
          '<a class="btn btn-primary" href="' + link + '">Apri nel Playground</a></article>';
      }).join("");
    }

    if (searchInput) searchInput.addEventListener("input", render);
    if (categorySelect) categorySelect.addEventListener("change", render);
    render();
  })();
  </script>
</body>
</html>
