export const EXERCISES = [
  { title: 'Prime 10 righe clienti', topic: 'SELECT', tags: ['base'], difficulty: 'Base', query: 'SELECT id, name, segment FROM customers ORDER BY id LIMIT 10;' },
  { title: 'Ordini pagati per stato', topic: 'GROUP BY', tags: ['aggregation'], difficulty: 'Base', query: 'SELECT status, COUNT(*) AS n_orders FROM orders GROUP BY status ORDER BY n_orders DESC;' },
  { title: 'Top clienti per revenue', topic: 'WINDOW', tags: ['window','ranking'], difficulty: 'Intermedio', query: 'SELECT customer_id, total_amount, ROW_NUMBER() OVER(PARTITION BY customer_id ORDER BY total_amount DESC) AS rn FROM orders WHERE status IN (\'PAID\',\'SHIPPED\') QUALIFY rn <= 3;' },
  { title: 'Sconto medio per canale', topic: 'GROUP BY', tags: ['aggregation'], difficulty: 'Intermedio', query: 'SELECT channel, ROUND(AVG(discount_amount),2) AS avg_disc FROM orders GROUP BY channel ORDER BY avg_disc DESC;' },
  { title: 'Ordini senza pagamento', topic: 'JOIN', tags: ['anti-join'], difficulty: 'Intermedio', query: 'SELECT o.id, o.customer_id FROM orders o LEFT JOIN payments p ON p.order_id = o.id WHERE p.id IS NULL;' },
  { title: 'Prodotti mai ordinati', topic: 'ANTI JOIN', tags: ['join'], difficulty: 'Intermedio', query: 'SELECT p.id, p.name FROM products p LEFT JOIN order_items oi ON oi.product_id = p.id WHERE oi.id IS NULL;' },
  { title: 'Sessioni duplicate', topic: 'DATA QUALITY', tags: ['dq','events'], difficulty: 'Intermedio', query: 'SELECT session_id, COUNT(*) AS hits FROM events GROUP BY session_id HAVING COUNT(*) > 5 ORDER BY hits DESC;' },
  { title: 'Ordini con outlier importo', topic: 'DATA QUALITY', tags: ['dq','outlier'], difficulty: 'Intermedio', query: 'SELECT id, total_amount FROM orders WHERE total_amount IS NULL OR total_amount > (SELECT AVG(total_amount)*4 FROM orders);' },
  { title: 'Retention mensile', topic: 'WINDOW', tags: ['cohort'], difficulty: 'Avanzato', query: "WITH first_order AS (SELECT customer_id, MIN(order_date) AS first_dt FROM orders GROUP BY customer_id), orders_month AS (SELECT customer_id, substr(order_date,1,7) AS ym FROM orders WHERE status IN ('PAID','SHIPPED')), cohort AS (SELECT o.customer_id, f.first_dt AS cohort_dt, o.ym FROM orders_month o JOIN first_order f ON f.customer_id=o.customer_id) SELECT cohort_dt, ym, COUNT(DISTINCT customer_id) AS active FROM cohort GROUP BY cohort_dt, ym ORDER BY cohort_dt, ym;" },
  { title: 'LTV per segmento', topic: 'AGG', tags: ['finance'], difficulty: 'Intermedio', query: 'SELECT segment, ROUND(SUM(total_amount),2) AS ltv FROM orders o JOIN customers c ON c.id=o.customer_id WHERE o.status IN (\'PAID\',\'SHIPPED\') GROUP BY segment ORDER BY ltv DESC;' },
  { title: 'Funnel add_to_cart -> purchase', topic: 'EVENTS', tags: ['funnel'], difficulty: 'Avanzato', query: "WITH steps AS (SELECT session_id, MIN(CASE WHEN event_type='add_to_cart' THEN 1 END) AS add_cart, MIN(CASE WHEN event_type='purchase' THEN 1 END) AS purchase FROM events GROUP BY session_id) SELECT SUM(add_cart) AS sessions_cart, SUM(purchase) AS sessions_purchase, ROUND(SUM(purchase)*1.0 / NULLIF(SUM(add_cart),0),2) AS conv_rate FROM steps;" },
  { title: 'Lead vs lag fatturato', topic: 'WINDOW', tags: ['lag','lead'], difficulty: 'Avanzato', query: "SELECT date, total_amount, LAG(total_amount) OVER(ORDER BY date) AS prev_total, LEAD(total_amount) OVER(ORDER BY date) AS next_total FROM fact_orders ORDER BY date LIMIT 50;" },
  { title: 'Revenue per store', topic: 'GROUP BY', tags: ['store'], difficulty: 'Intermedio', query: 'SELECT store_id, COUNT(*) AS n_orders, ROUND(SUM(total_amount),2) AS revenue FROM orders WHERE status IN (\'PAID\',\'SHIPPED\') GROUP BY store_id ORDER BY revenue DESC;' },
  { title: 'Ordini recenti per cliente', topic: 'WINDOW', tags: ['top-n'], difficulty: 'Intermedio', query: "SELECT * FROM (SELECT id, customer_id, total_amount, order_date, ROW_NUMBER() OVER(PARTITION BY customer_id ORDER BY order_date DESC) AS rn FROM orders) WHERE rn <= 2;" },
  { title: 'Indice candidato', topic: 'PERFORMANCE', tags: ['explain','index'], difficulty: 'Avanzato', query: "EXPLAIN QUERY PLAN SELECT * FROM orders WHERE customer_id = 10 AND status = 'PAID' ORDER BY order_date DESC LIMIT 20;" },
  { title: 'Distribuzione sconti', topic: 'ANALYSIS', tags: ['histogram'], difficulty: 'Base', query: 'SELECT discount_amount, COUNT(*) AS freq FROM orders GROUP BY discount_amount ORDER BY freq DESC LIMIT 20;' },
  { title: 'Ritardi spedizioni', topic: 'DATE', tags: ['shipping'], difficulty: 'Intermedio', query: "SELECT o.id, julianday(s.delivered_at) - julianday(s.shipped_at) AS days FROM shipments s JOIN orders o ON o.id = s.order_id WHERE s.status = 'DELIVERED' ORDER BY days DESC LIMIT 20;" },
  { title: 'Cross-sell prodotti', topic: 'SELF JOIN', tags: ['basket'], difficulty: 'Avanzato', query: "WITH basket AS (SELECT order_id, GROUP_CONCAT(DISTINCT product_id) AS products FROM order_items GROUP BY order_id) SELECT b.products FROM basket b WHERE b.products LIKE '%,%' LIMIT 20;" },
  { title: 'Clienti senza contatto', topic: 'DATA QUALITY', tags: ['dq'], difficulty: 'Base', query: "SELECT id, name FROM customers WHERE email IS NULL AND phone IS NULL;" },
  { title: 'Eventi per device', topic: 'GROUP BY', tags: ['events'], difficulty: 'Base', query: "SELECT device, COUNT(*) AS hits FROM events GROUP BY device ORDER BY hits DESC;" },
  { title: 'Ordini cancellati', topic: 'FILTER', tags: ['status'], difficulty: 'Base', query: "SELECT id, customer_id, total_amount FROM orders WHERE status = 'CANCELLED' LIMIT 20;" },
  { title: 'Margin per prodotto', topic: 'AGG', tags: ['finance'], difficulty: 'Intermedio', query: "SELECT p.id, p.name, ROUND(SUM(oi.quantity * (oi.unit_price - p.cost_price)),2) AS margin FROM order_items oi JOIN products p ON p.id = oi.product_id GROUP BY p.id ORDER BY margin DESC LIMIT 20;" },
  { title: 'Distribuzione ordini settimanale', topic: 'DATE', tags: ['calendar'], difficulty: 'Base', query: "SELECT week, COUNT(*) AS n FROM dim_date d JOIN fact_orders f ON f.date = d.date GROUP BY week ORDER BY week;" },
  { title: 'Recency clienti', topic: 'WINDOW', tags: ['recency'], difficulty: 'Intermedio', query: "SELECT customer_id, MAX(order_date) AS last_order FROM orders GROUP BY customer_id ORDER BY last_order DESC LIMIT 20;" },
  { title: 'CTE ricorsiva calendario', topic: 'CTE', tags: ['recursive'], difficulty: 'Avanzato', query: "WITH RECURSIVE dates(d) AS (SELECT MIN(order_date) FROM orders UNION ALL SELECT date(d, '+1 day') FROM dates WHERE d < (SELECT MAX(order_date) FROM orders)) SELECT COUNT(*) FROM dates;" },
  { title: 'Ordini multi-moneta', topic: 'JOIN', tags: ['currency'], difficulty: 'Intermedio', query: "SELECT o.id, o.currency, r.usd_rate, ROUND(o.total_amount * r.usd_rate,2) AS usd_value FROM orders o JOIN currency_rates r ON r.currency = o.currency;" },
  { title: 'Fraud check duplicati', topic: 'DATA QUALITY', tags: ['dq'], difficulty: 'Avanzato', query: "SELECT customer_id, total_amount, COUNT(*) AS dup FROM orders GROUP BY customer_id, total_amount HAVING COUNT(*) > 2;" },
  { title: 'Percorso pagina', topic: 'EVENTS', tags: ['path'], difficulty: 'Intermedio', query: "SELECT session_id, GROUP_CONCAT(page, ' -> ') AS path FROM events GROUP BY session_id LIMIT 20;" },
  { title: 'Delta mese su mese', topic: 'WINDOW', tags: ['delta'], difficulty: 'Intermedio', query: "WITH monthly AS (SELECT substr(order_date,1,7) AS ym, SUM(total_amount) AS revenue FROM orders WHERE status IN ('PAID','SHIPPED') GROUP BY substr(order_date,1,7)) SELECT ym, revenue, revenue - LAG(revenue) OVER(ORDER BY ym) AS delta FROM monthly;" },
  { title: 'Ordini per segmento', topic: 'GROUP BY', tags: ['segment'], difficulty: 'Base', query: "SELECT c.segment, COUNT(*) AS n FROM orders o JOIN customers c ON c.id=o.customer_id GROUP BY c.segment ORDER BY n DESC;" },
  { title: 'Prodotti attivi', topic: 'FILTER', tags: ['product'], difficulty: 'Base', query: "SELECT id, name, category, price FROM products WHERE active = 1 LIMIT 20;" },
  { title: 'Ticket di reso', topic: 'RETURNS', tags: ['returns'], difficulty: 'Intermedio', query: "SELECT r.id, r.order_id, r.refund_amount FROM returns r ORDER BY r.refund_amount DESC LIMIT 20;" },
  { title: 'Indice parziale', topic: 'DDL', tags: ['index'], difficulty: 'Avanzato', query: "CREATE INDEX IF NOT EXISTS idx_orders_paid ON orders(customer_id) WHERE status='PAID';" },
  { title: 'EXPLAIN join customer-orders', topic: 'PERFORMANCE', tags: ['explain'], difficulty: 'Avanzato', query: "EXPLAIN QUERY PLAN SELECT c.name, SUM(o.total_amount) FROM customers c JOIN orders o ON o.customer_id = c.id GROUP BY c.id;" }
];
