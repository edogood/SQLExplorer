<!doctype html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Percorso Guidato | SQL Lab</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;600;700;800&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="bg-shape bg-shape-one" aria-hidden="true"></div>
  <div class="bg-shape bg-shape-two" aria-hidden="true"></div>

  <header class="site-header">
    <div class="header-inner">
      <a href="index.html" class="brand">SQL Lab Completo</a>
      <nav class="top-nav">
        <a href="playground.html">Playground</a>
        <a href="database.html">Database</a>
        <a href="exercises.html">Esercizi</a>
        <a href="guided.html">Percorso</a>
        <a href="trainer.html">Trainer</a>
        <a href="syntax.html">Sintassi</a>
        <a href="keywords.html">Keyword</a>
      </nav>
    </div>
  </header>

  <main class="page">
    <section class="hero">
      <p class="kicker">Percorso Guidato SQL</p>
      <h1>Step progressivi con verifica e tracking</h1>
      <p class="hero-copy">Seleziona uno step e aprilo nel Playground con query prefillata e verifica output-based.</p>
    </section>

    <section class="panel">
      <div class="panel-head">
        <h2>Step disponibili</h2>
        <p>Ogni step ha obiettivo, hint e keyword target. Clicca per aprire nel Playground.</p>
      </div>
      <div id="guidedStepList" class="exercise-grid"></div>
    </section>
  </main>

  <script>
  (function () {
    var GUIDED_STEPS = [
      { id: "s1", title: "Filtro base clienti", goal: "Trova i clienti Enterprise ordinati per credit_limit decrescente.", topics: ["SELECT", "WHERE", "ORDER BY", "LIMIT/TOP"], query: "SELECT id, name, segment, credit_limit\nFROM customers\n/* TODO: filtra segmento Enterprise */\nORDER BY credit_limit DESC\nLIMIT 20;" },
      { id: "s2", title: "Join + aggregazione revenue", goal: "Calcola il revenue per segmento e valuta media ordine.", topics: ["JOIN", "GROUP BY", "SUM", "AVG"], query: "SELECT c.segment,\n       ROUND(SUM(o.total_amount), 2) AS revenue,\n       ROUND(AVG(o.total_amount), 2) AS avg_order\nFROM customers c\nJOIN orders o ON o.customer_id = c.id\nWHERE o.status IN ('PAID','SHIPPED','REFUNDED')\nGROUP BY c.segment\nORDER BY revenue DESC;" },
      { id: "s3", title: "CTE e trend mensile", goal: "Costruisci trend mensile e delta col mese precedente.", topics: ["WITH", "LAG", "OVER", "ORDER BY"], query: "WITH monthly AS (\n  SELECT substr(order_date, 1, 7) AS mese,\n         ROUND(SUM(total_amount), 2) AS totale\n  FROM orders\n  WHERE status IN ('PAID','SHIPPED','REFUNDED')\n  GROUP BY substr(order_date, 1, 7)\n)\nSELECT mese,\n       totale,\n       ROUND(totale - LAG(totale) OVER (ORDER BY mese), 2) AS delta\nFROM monthly\nORDER BY mese;" },
      { id: "s4", title: "Cast e Convert", goal: "Mostra totale ordine come numero intero e come testo nel dialetto attivo.", topics: ["CAST", "CONVERT", "TRY_CONVERT"], query: "SELECT o.id,\n       CAST(o.total_amount AS INTEGER) AS total_int,\n       CONVERT('TEXT', o.total_amount) AS total_text,\n       TRY_CONVERT('REAL', o.total_amount) AS total_real\nFROM orders o\nORDER BY o.total_amount DESC\nLIMIT 20;" },
      { id: "s5", title: "Transazione con rollback", goal: "Simula aumento prezzi software e annulla tutto con ROLLBACK.", topics: ["BEGIN", "UPDATE", "ROLLBACK"], query: "BEGIN;\nUPDATE products\nSET price = ROUND(price * 1.02, 2)\nWHERE category = 'Software';\nSELECT category, ROUND(AVG(price), 2) AS avg_price\nFROM products\nGROUP BY category;\nROLLBACK;" }
    ];

    var container = document.getElementById("guidedStepList");
    if (!container) return;

    container.innerHTML = GUIDED_STEPS.map(function (step, idx) {
      var tags = step.topics.map(function (t) { return '<span class="guided-chip">' + t + '</span>'; }).join(" ");
      var encodedQuery = encodeURIComponent(step.query);
      var link = "playground.html?q=" + encodedQuery + "&autorun=1#guided";
      return '<article class="keyword-card"><div class="keyword-head"><h3>Step ' + (idx + 1) + ': ' + step.title + '</h3></div>' +
        '<p>' + step.goal + '</p>' +
        '<div class="guided-topics" style="margin:0.5rem 0">' + tags + '</div>' +
        '<a class="btn btn-primary" href="' + link + '">Apri nel Playground</a></article>';
    }).join("");
  })();
  </script>
</body>
</html>
